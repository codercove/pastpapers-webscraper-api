import axios from"axios";import{load}from"cheerio";import express from"express";import{config}from"dotenv";config();const app=express(),PORT=process.env.PORT||8e3;app.listen(PORT,(()=>console.log(`Server is running on PORT ${PORT}`)));const start=async(s,t)=>{let e=[];try{const o=(await axios.get(`https://pastpapers.wiki/grade-${s}-${t}/`)).data,a=load(o);a("a").each((async function(){const s=a(this).attr("href"),t=a(this).text(),o=s.split("-");for(const a in o)if("paper"===o[a])try{const o=(await axios.get(s)).data,a=load(o);a(".wpfd_downloadlink").each((function(){const s=a(this).attr("href");e.push({id:0,name:t,url:s}),j++}))}catch(s){console.error(s)}}))}catch(s){console.error(s)}};app.get("/:grade/:subject",(async(s,t)=>{const e=await start(s.params.grade,s.params.subject);setTimeout((()=>{if(e){console.log(e);const s={status:200,error:!1,message:"successfull",items:e};t.set("Access-Control-Allow-Origin","*").status(201).send(s)}else t.set("Access-Control-Allow-Origin","*").status(404).send({status:404,error:!0,message:"requested data not found"})}),2e3)}));
