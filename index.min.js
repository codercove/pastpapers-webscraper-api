import axios from"axios";import{load}from"cheerio";import express from"express";import{config}from"dotenv";config();const app=express(),PORT=process.env.PORT||8e3;app.listen(PORT,(()=>console.log(`Server is running on PORT ${PORT}`)));const start=async(s,t)=>{let e=0,o=[];try{const a=(await axios.get(`https://pastpapers.wiki/grade-${s}-${t}/`)).data,r=load(a);r("a").each((async function(){const s=r(this).attr("href"),t=r(this).text(),a=s.split("-");for(const r in a)if("paper"===a[r])try{const a=(await axios.get(s)).data,r=load(a);r(".wpfd_downloadlink").each((function(){const s=r(this).attr("href");o.push({id:e,name:t,url:s}),e++}))}catch(s){console.error(s)}}))}catch(s){console.error(s)}finally{return o}};app.get("/:grade/:subject",(async(s,t)=>{const e=await start(s.params.grade,s.params.subject);setTimeout((()=>{if(e.length>0){console.log(e);const s={status:200,error:!1,message:"successfull",items:e};t.set("Access-Control-Allow-Origin","*").status(201).send(s)}else t.set("Access-Control-Allow-Origin","*").status(404).send({status:404,error:!0,message:"requested data not found"})}),2e3)}));
